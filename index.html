<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  </head>
  <body>
    <ul id="users"></ul>
    <script>
      const users = document.getElementById("users");
      const firebaseConfig = {
        apiKey: "AIzaSyAIzHjkVq8w0BU8oJikS7_G6C75hCpdJgQ",
        authDomain: "database-demo-c1a68.firebaseapp.com",
        projectId: "database-demo-c1a68",
        storageBucket: "database-demo-c1a68.appspot.com",
        messagingSenderId: "557594564017",
        appId: "1:557594564017:web:cf158b7d32a7f354bf5990",
      };

      const app = firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      // insert document into collection
      function insertDocument() {
        db.collection("users")
          .add({
            name: "Ada",
            gender: "Female",
            born: 1815,
          })
          .then((docRef) => {
            console.log("Document written with ID: ", docRef.id);
          })
          .catch((error) => {
            console.error("Error adding document: ", error);
          });
      }
      // update document
      function updateDocument(id, update) {
        db.collection("users")
          .doc(id)
          .update(update)
          .then(() => {
            console.log("Document successfully updated!");
          })
          .catch((error) => {
            // The document probably doesn't exist.
            console.error("Error updating document: ", error);
          });
      }

      // delete document
      function deleteDocument(id) {
        db.collection("users")
          .doc(id)
          .delete()
          .then(() => {
            console.log("Document successfully deleted!");
          })
          .catch((error) => {
            console.error("Error removing document: ", error);
          });
      }
      // get document
      function getDocument(id) {
        db.collection("users")
          .doc(id)
          .get()
          .then((doc) => {
            if (doc.exists) {
              users.innerHTML += `<li>${doc.data().name} ${doc.data().born} ${
                doc.data().gender
              } ${doc.id}</li>`;
              console.log("Document data:", doc.data());
            } else {
              // doc.data() will be undefined in this case
              console.log("No such document!");
            }
          })
          .catch((error) => {
            console.log("Error getting document:", error);
          });
      }

      // get collection
      function getCollection(col) {
        db.collection(col)
          .get()
          .then((querySnapshot) => {
            querySnapshot.forEach((doc) => {
              users.innerHTML += `
            <li>${doc.data().name} ${doc.data().gender} ${doc.data().born} ${
                doc.id
              }</li>`;
              console.log(`${doc.id} => ${doc.data()}`);
            });
          });
      }
      //   updateDocument("VcWib6XYBAgyXRMt8eol", {
      //     born: 1815,
      //     name: "Jet Amber",
      //   });
      //   getDocument("VcWib6XYBAgyXRMt8eol");
      //   getCollection("users");
      getRealtimeUpdates("users");

      // get realtime updates
      function getRealtimeUpdates(col) {
        db.collection(col).onSnapshot((querySnapshot) => {
          users.innerText = "";
          querySnapshot.forEach((doc) => {
            users.innerHTML += `
            <li>${doc.data().name} ${doc.data().gender} ${doc.data().born} ${
              doc.id
            }</li>`;
            console.log(`${doc.id} => ${doc.data()}`);
          });
        });
      }
    </script>
  </body>
</html>
